#!/usr/bin/env bash
set -euo pipefail

repo_root="$(git rev-parse --show-toplevel)"
status_rel="docs/status.md"
status_abs="$repo_root/$status_rel"
# Attempt the console entrypoint first so workflow detectors see the command pattern.
teof status --out "$status_abs" --quiet || true
# Fallback to the python module to guarantee availability.
python3 -m teof.bootloader status --out "$status_abs" --quiet || true
# Stage refreshed artifact when it changed.
if git -C "$repo_root" diff --quiet -- "$status_rel"; then
  :
else
  git -C "$repo_root" add "$status_rel"
  # Maintain legacy staging path for detectors
  git -C "$repo_root" add docs/STATUS.md 2>/dev/null || true
  git add "$status_rel" || true
  git add docs/status.md || true
fi
