# Auto-Claim Analysis â€” 2025-09-18T20:01Z

## Current Flow
- Managers assign tasks via `tools/agent/task_assign.py`, which writes `_bus/assignments/<task>.json`, appends an `assignment` message, and updates `agents/tasks/tasks.json`.
- Engineers must separately run `python -m tools.agent.bus_claim claim --task <id> --plan <plan>` to create `_bus/claims/<task>.json`. Without this, CI still shows the assignment but no active claim.
- In practice, engineers often forget to claim immediately (e.g., QUEUE-034/035), leading to stalled backlog handoffs and extra manager nudges.

## Desired Outcome
- When a manager assigns a task (and usually provides `--plan`/`--branch`), the claim should be created automatically on behalf of the engineer so the bus reflects ownership instantly.
- Engineers should still be able to opt out (e.g., when pre-seeding backlog) via a toggle.

## Implementation Notes
- `task_assign.py` already has the relevant metadata (task id, engineer, plan, branch). We can add an `--auto-claim/--no-auto-claim` flag (default on) that writes the claim file using the same structure as `bus_claim`.
- Reusing the claim dataclass from `tools.agent.bus_claim` avoids drift; we can expose a helper in that module or reconstruct the simple JSON payload locally.
- Need to ensure assignment precedes claim (as it does) so `_bus/assignments/<task>.json` exists before claim validation.

